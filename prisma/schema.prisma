generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  patient
  professional
  reception
  admin
}

model User {
  id           String   @id @default(uuid())
  name         String?
  email        String   @unique
  passwordHash String   @map("password_hash")
  primaryRole  UserRole @map("primary_role_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("users")
}

enum AppointmentStatus {
  pending
  confirmed
  cancelled
}

model Patient {
  id        String   @id @default(uuid())
  name      String
  email     String?
  phone     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  appointments Appointment[]

  @@map("patients")
}

model Appointment {
  id           String             @id @default(uuid())
  patientId    String?
  specialistId String?
  service      String
  scheduledAt  DateTime           @map("scheduled_at")
  status       AppointmentStatus  @default(pending)
  notes        String?
  createdAt    DateTime           @default(now()) @map("created_at")
  updatedAt    DateTime           @updatedAt @map("updated_at")

  patient Patient? @relation(fields: [patientId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@map("appointments")
}

model Schedule {
  id           String   @id @default(uuid())
  specialistId String
  start        DateTime
  end          DateTime
  available    Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("schedules")
  @@unique([specialistId, start, end], name: "specialistId_start_end")
}
